function generateCode(){codeContainer.textContent=source.innerHTML}function generateFile(){var e="data:image/svg+xml;utf8,"+encodeURIComponent(source.innerHTML);downloadButton.setAttribute("href",e)}function getAngle(e){"semiCircle"==typeOfCircle&&gaps===!1?angle=180/e:"fullCircle"==typeOfCircle&&gaps===!1&&(angle=360/e),"semiCircle"==typeOfCircle&&gaps===!0?angle=180/e-180/e/gap:"fullCircle"==typeOfCircle&&gaps===!0&&(angle=360/e-360/e/gap)}function getPizzaCoordinates(e,t,n){var i=n.x,o=n.y,r=-e*Math.PI/180,a=i+t*Math.cos(r),l=o+t*Math.sin(r);pizzaCoordinates.x=a,pizzaCoordinates.y=l}function getCutCoordinates(e,t,n){var i=n.x,o=n.y,r=-e*Math.PI/180,a=i+t*Math.cos(r),l=o+t*Math.sin(r);pieCoordinates.x=a,pieCoordinates.y=l}function isOdd(e){return e%2}function rotateItems(e){for(var t=svg.querySelectorAll(".item"),n,i,o,r=0;r<t.length;r++){var a=t[r];gaps===!1&&(o=-angle*r),gaps===!0&&"semiCircle"==typeOfCircle&&(n=nbOfSlices*(180/nbOfSlices/gap),i=n/(nbOfSlices-1),o=-r*(angle+i)),gaps===!0&&"fullCircle"==typeOfCircle&&(n=nbOfSlices*(360/nbOfSlices/gap),i=n/nbOfSlices,o=-r*(angle+i));var l=a.getBBox();a.setAttribute("transform","rotate("+o+" "+e.x+" "+e.y+")"),TweenLite.set(a,{rotation:o,transformOrigin:e.x-l.x+"px "+(e.y-l.y)+"px"}),a.removeAttribute("style")}}function drawPizzaSectors(e,t){for(var n=0;nbOfSlices>n;n++){var i=document.createElementNS(svgns,"a");i.setAttribute("class","item"),i.setAttribute("id","item-"+(n+1)),i.setAttributeNS(xlinkns,"xlink:href",""),i.setAttributeNS(xlinkns,"xlink:title",""),i.setAttribute("role","link"),i.setAttribute("tabindex","0"),i.setAttributeNS(xlinkns,"target","_parent");var o=document.createElementNS(svgns,"path");o.setAttribute("fill","none"),o.setAttribute("stroke","#111"),o.setAttribute("stroke-width","1"),o.setAttribute("class","sector"),o.setAttribute("d","M"+e.x+","+e.y+" l"+t+",0 A"+t+","+t+" 0 0,0 "+pizzaCoordinates.x+","+pizzaCoordinates.y+" z"),i.appendChild(o),itemsContainer.appendChild(document.createTextNode("		")),itemsContainer.appendChild(i),itemsContainer.appendChild(document.createTextNode("\n"))}}function drawCutSectors(e,t,n){for(var i=0;nbOfSlices>i;i++){var o=document.createElementNS(svgns,"a");o.setAttribute("class","item"),o.setAttribute("id","item-"+(i+1)),o.setAttribute("role","link"),o.setAttribute("tabindex","0"),o.setAttributeNS(xlinkns,"xlink:href"," "),o.setAttributeNS(xlinkns,"xlink:title"," ");var r=document.createElementNS(svgns,"path");r.setAttribute("fill","none"),r.setAttribute("stroke","#111"),r.setAttribute("d","M"+(e.x+n)+","+e.y+" l"+(t-n)+",0 A"+t+","+t+" 0 0,0 "+pizzaCoordinates.x+","+pizzaCoordinates.y+" l"+-(pizzaCoordinates.x-pieCoordinates.x)+","+(-pizzaCoordinates.y+pieCoordinates.y)+" A"+n+","+n+" 0 0,1 "+(e.x+n)+","+e.y),r.setAttribute("class","sector"),o.appendChild(r),itemsContainer.appendChild(document.createTextNode("		")),itemsContainer.appendChild(o),itemsContainer.appendChild(document.createTextNode("\n"))}}function clearCanvas(){for(var e=svg.querySelectorAll(".item"),t=0;t<e.length;t++){var n=e[t],i=n.parentNode;i.removeChild(n)}for(var o=svg.querySelectorAll(".icon"),t=0;t<o.length;t++){var r=o[t],i=r.parentNode;i.removeChild(r)}itemsContainer.textContent="",symbolsContainer.textContent=""}function triggerControlHandler(){circle.setAttribute("r",this.value),generateFile()}function gapControlHandler(){gap=this.value,init()}function smallRadiusControlHandler(){menuSmallRadius=parseInt(this.value),init()}function iconPosControlHandler(){iconPos=this.value,init()}function iconSizeControlHandler(){iconWidth=this.value,iconHeight=this.value,init()}function enableGapControl(){gapControl.disabled=!1}function disableGapControl(){gapControl.disabled=!0}function enableRadiusControl(){smallRadiusControl.disabled=!1}function disableRadiusControl(){smallRadiusControl.disabled=!0}function addIcons(){var e=document.querySelectorAll(".item"),t=document.createElementNS(svgns,"path");t.setAttribute("d","M"+pizzaCoordinates.x+","+pizzaCoordinates.y+" L"+2*menuRadius+","+menuRadius);for(var n=t.getTotalLength(),i=0;i<e.length;i++){var o=e[i];o.onclick=function(e){e.preventDefault()};var t=document.createElementNS(svgns,"path");t.setAttribute("d","M"+pizzaCoordinates.x+","+pizzaCoordinates.y+" L"+2*menuRadius+","+menuRadius),t.setAttribute("stroke","#ddd");var r={};angle>90?(r.x=pizzaCoordinates.x+(2*menuRadius-pizzaCoordinates.x)/2+50,r.y=pizzaCoordinates.y+(menuRadius-pizzaCoordinates.y)/2-50):(r.x=pizzaCoordinates.x+(2*menuRadius-pizzaCoordinates.x)/2,r.y=pizzaCoordinates.y+(menuRadius-pizzaCoordinates.y)/2);var a=document.createElementNS(svgns,"circle");a.setAttribute("cx",r.x),a.setAttribute("cy",r.y),a.setAttribute("r","5");var l=document.createElementNS(svgns,"path");l.setAttribute("d","M"+menuCenter.x+","+menuCenter.y+" L"+r.x+","+r.y),l.setAttribute("stroke","orange");var s=l.getPointAtLength(iconPos),u=document.createElementNS(svgns,"circle");u.setAttribute("cx",s.x),u.setAttribute("cy",s.y),u.setAttribute("r","5");var c=document.createElementNS(svgns,"use");c.setAttributeNS(xlinkns,"xlink:href","#icon-"+(i+1)),c.setAttribute("width",iconWidth),c.setAttribute("height",iconHeight),c.setAttribute("x",s.x-c.getAttribute("width")/2),c.setAttribute("y",s.y-c.getAttribute("height")/2),c.setAttribute("transform","rotate("+(90-angle+angle/2)+" "+s.x+" "+s.y+")"),o.appendChild(c);var d=document.createElementNS(svgns,"symbol");d.setAttribute("class","icon icon-"),d.setAttribute("id","icon-"+(i+1)),d.setAttribute("viewBox","0 0 "+iconWidth+" "+iconHeight);var m=document.createElementNS(svgns,"rect");m.setAttribute("fill","none"),m.setAttribute("stroke","#111"),m.setAttribute("stroke-width","1"),m.setAttribute("width","100%"),m.setAttribute("height","100%");var g=document.createElementNS(svgns,"text");g.setAttribute("fill","#222"),g.setAttribute("x","50%"),g.setAttribute("y","50%"),g.setAttribute("dy",".3em"),g.setAttribute("text-anchor","middle"),g.setAttribute("font-size","1.2em"),g.textContent=i+1;var C=document.createComment("Replace the contents of this symbol with the content of your icon");d.appendChild(C),d.appendChild(m),d.appendChild(g),symbolsContainer.appendChild(document.createTextNode("	")),symbolsContainer.appendChild(d),symbolsContainer.appendChild(document.createTextNode("\n\n"))}}function init(){clearCanvas(),iconPosControl.setAttribute("max",.85*menuRadius),iconPosControl.setAttribute("value",.68*menuRadius),gaps?(enableGapControl(),gapControl.setAttribute("max",angle),gapControl.setAttribute("min",nbOfSlices-1)):gaps||disableGapControl(),getAngle(nbOfSlices),getPizzaCoordinates(angle,menuRadius,menuCenter),"pizza"==menuStyle?(drawPizzaSectors(menuCenter,menuRadius),disableRadiusControl()):"pie"==menuStyle&&(getCutCoordinates(angle,menuSmallRadius,menuCenter),drawCutSectors(menuCenter,menuRadius,menuSmallRadius),enableRadiusControl()),rotateItems(menuCenter),addIcons(),generateCode(),generateFile()}function makeSpinnable(e){CSSPlugin.useSVGTransformAttr=!0,TweenLite.set(svg,{rotation:0,transformOrigin:"50% 50%"}),Draggable.create(svg,{type:"rotation",throwProps:!0,dragClickables:!0,onThrowComplete:function(){generateCode(),generateFile()}})}var svg=document.getElementById("menu"),svgns="http://www.w3.org/2000/svg",xlinkns="http://www.w3.org/1999/xlink",symbolsContainer=svg.getElementById("symbolsContainer"),itemsContainer=svg.getElementById("itemsContainer"),trigger=svg.getElementById("trigger"),codeContainer=document.getElementById("codeContainer").querySelector("code"),source=document.getElementById("demo"),smallRadiusContainer=document.getElementById("smallRadiusSliderContainer"),smallRadiusControl=document.getElementById("smallRadiusControl"),triggerControl=document.getElementById("triggerControl"),iconPosControl=document.getElementById("iconPosControl"),iconSizeControl=document.getElementById("iconSizeControl"),gapControl=document.getElementById("gapControl"),circle=svg.querySelector("#trigger circle"),downloadButton=document.getElementById("download-button"),resetButton=document.getElementById("reset-button"),nb=document.getElementById("nb"),typePicker=document.getElementsByName("type"),stylePicker=document.getElementsByName("style"),gapOption=document.getElementById("gaps"),nbOfSlices=parseInt(nb.value),typeOfCircle=document.querySelector('input[name="type"]:checked').value,menuStyle=document.querySelector('input[name="style"]:checked').value,gaps=document.getElementById("gaps").checked,menuCenter={x:250,y:250},menuRadius=250,menuSmallRadius=125,iconPos;iconPos="pie"==menuStyle?.75*menuRadius:.68*menuRadius;var iconWidth=40,iconHeight=40,angle,pizzaCoordinates={},pieCoordinates={},gap=10;typePicker[0].onclick=function(){typeOfCircle=this.value,init()},typePicker[1].onclick=function(){typeOfCircle=this.value,init()},stylePicker[0].onclick=function(){menuStyle=this.value,init()},stylePicker[1].onclick=function(){menuStyle=this.value,init()},nb.onchange=function(){this.value<3&&(this.value=3),this.value>12&&(this.value=12),nbOfSlices=parseInt(this.value),codeContainer.textContent=source.innerHTML,init()},gapOption.onclick=function(){gaps=this.checked,init()},smallRadiusControl.addEventListener("change",smallRadiusControlHandler,!1),smallRadiusControl.addEventListener("input",smallRadiusControlHandler,!1),triggerControl.addEventListener("change",triggerControlHandler,!1),triggerControl.addEventListener("input",triggerControlHandler,!1),iconPosControl.addEventListener("change",iconPosControlHandler,!1),iconPosControl.addEventListener("input",iconPosControlHandler,!1),iconSizeControl.addEventListener("change",iconSizeControlHandler,!1),iconSizeControl.addEventListener("input",iconSizeControlHandler,!1),gapControl.addEventListener("change",gapControlHandler,!1),gapControl.addEventListener("input",gapControlHandler,!1),resetButton.onclick=function(){nbOfSlices=8,gaps=!1,gap=10,gapControl.value=10,circle.setAttribute("r","30"),triggerControl.value=30,menuStyle="pizza",typeOfCircle="fullCircle",iconPos=.68*menuRadius,iconPosControl.value=.68*menuRadius,iconWidth=40,iconHeight=40,iconSizeControl.value=40,nb.value=nbOfSlices,typePicker[0].checked=!0,typePicker[1].checked&&(typePicker[1].checked=!1,typePicker[1].removeAttribute("checked")),stylePicker[0].checked=!0,stylePicker[1].checked&&(stylePicker[1].checked=!1,stylePicker[1].removeAttribute("checked")),gapOption.checked=!1,gapControl.setAttribute("value","10"),gapControl.value=10,smallRadiusControl.setAttribute("value","125"),smallRadiusControl.value=125,TweenLite.set(svg,{rotation:0,transformOrigin:"50% 50%"}),init()},downloadButton.addEventListener("click",function(e){var t=source.innerHTML;navigator.msSaveBlob&&(e.preventDefault(),navigator.msSaveBlob(new Blob([t],{type:"image/svg+xml"}),"svg-circular-menu.svg"))}),init(),makeSpinnable();